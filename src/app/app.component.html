<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container">
    <a class="navbar-brand" href="">Zax Relay</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbar">
      <form class="form-inline mr-auto">
        <div class="form-group" *ngIf="!isEditing">
          <label for="relayURL" class="sr-only">Relay URL</label>
          <input type="text" readonly class="form-control ml-sm-4 mr-sm-2" name="relayURL" placeholder="Relay URL"
            id="relayURL" [(ngModel)]="relayURL">
        </div>
        <div class="form-group" *ngIf="isEditing">
          <label for="relayURL2" class="sr-only">Relay URL</label>
          <input type="text" class="form-control ml-sm-4 mr-sm-2" name="relayURL2" id="relayURL2"
            placeholder="Relay URL" [(ngModel)]="editingURL">
        </div>
        <button class="btn btn-success my-2 mr-2 my-sm-0" *ngIf="isEditing" (click)="updateRelay()">Save</button>
        <button class="btn btn-secondary my-2 my-sm-0"
          (click)="isEditing = !isEditing">{{ isEditing ? 'Cancel' : 'Change' }}</button>
      </form>
      <ul class="navbar-nav my-2 my-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="http://bit.ly/nacl_relay_spec" target="_blank">Technical spec</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/vault12/zax-dash" target="_blank">GitHub</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://slack.vault12.com/" target="_blank">Slack</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-sm-4 col-md-3">
      <div *ngIf="mailboxes.length">
        <button class="btn btn-success btn-narrow float-right mb-2" type="button" (click)="refreshCounter()">‚ü≥
          Refresh</button>
        <div class="loader float-right mr-2" *ngIf="showRefreshLoader"></div>
        <h4>Mailboxes</h4>
        <div class="clearfix"></div>
        <ul class="list-group mb-4">
          <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            *ngFor="let mailbox of mailboxes" (click)="selectMailbox(mailbox); viewMailboxSubscreen = 'inbox'"
            [ngClass]="{'active': mailbox == activeMailbox}">
            {{ mailbox.identity }}
            <span class="badge badge-pill"
              [ngClass]="{'badge-primary': mailbox.messageCount > 0, 'badge-light': mailbox.messageCount == 0}">
              {{ mailbox.messageCount }}</span>
          </li>
        </ul>
      </div>
      <button type="button" class="btn btn-block btn-outline-success" *ngIf="mailboxes.length"
        (click)="activeMailbox = null">+
        Add</button>
    </div>

    <div class="col-sm-8 col-md-9" *ngIf="!activeMailbox">
      <h2 class="text-center align-middle mt-8 mt-4 text-muted">No mailbox selected</h2>
      <div class="col-md-6 offset-md-3">
        <hr />
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': newMailboxSubscreen == 'new'}" href="#"
              (click)="newMailboxSubscreen = 'new'">New</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': newMailboxSubscreen == 'seed'}" href="#"
              (click)="newMailboxSubscreen = 'seed'">From
              Seed</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': newMailboxSubscreen == 'secret'}" href="#"
              (click)="newMailboxSubscreen = 'secret'">From Secret key</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': newMailboxSubscreen == 'multiple'}" href="#"
              (click)="newMailboxSubscreen = 'multiple'">Multiple</a>
          </li>
        </ul>
        <div class="form-group mt-4" *ngIf="newMailboxSubscreen != 'multiple'">
          <input type="text" class="form-control" [(ngModel)]="newMailbox.name" placeholder="Mailbox name">
          <button class="btn btn-success btn-block mt-3" *ngIf="newMailboxSubscreen == 'new'" type="button"
            (click)="addMailbox(newMailbox.name)">Add</button>
        </div>
        <div class="form-group" *ngIf="newMailboxSubscreen == 'seed'">
          <input type="text" class="form-control" [(ngModel)]="newMailbox.seed" placeholder="Seed">
          <button class="btn btn-success btn-block mt-3" type="button"
            (click)="addMailbox(newMailbox.name, {seed:newMailbox.seed})">Add</button>
        </div>
        <div class="form-group" *ngIf="newMailboxSubscreen == 'secret'">
          <input type="text" class="form-control" [(ngModel)]="newMailbox.secret" placeholder="Secret">
          <button class="btn btn-success btn-block mt-3" type="button"
            (click)="addMailbox(newMailbox.name, {secret:newMailbox.secret})">Add</button>
        </div>

        <div class="form-group mt-4" *ngIf="newMailboxSubscreen == 'multiple'">
          <select class="custom-select form-control" [(ngModel)]="quantity">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="10">10</option>
          </select>
          <button class="btn btn-success btn-block mt-3" type="button" (click)="addMailboxes(quantity)">Add Multiple
            Mailboxes</button>
        </div>
      </div>
    </div>

    <div class="col-sm-8 col-md-9" *ngIf="activeMailbox">
      <button class="btn btn-danger float-right" (click)="deleteMailbox(activeMailbox)">Delete Mailbox</button>
      <h4>{{ activeMailbox.identity }}</h4>
      <form class="mt-4">
        <div class="form-group row">
          <label for="secretKey" class="col-sm-2 col-form-label">Secret Key</label>
          <div class="col-sm-10">
            <input type="text" readonly class="form-control" id="secretKey"
              value="{{ activeMailbox.keyRing.commKey.strSecKey() }}">
          </div>
        </div>
        <div class="form-group row">
          <label for="publicKey" class="col-sm-2 col-form-label">Public Key</label>
          <div class="col-sm-10">
            <input type="text" readonly class="form-control" id="publicKey"
              value="{{ activeMailbox.keyRing.commKey.strPubKey() }}">
          </div>
        </div>
      </form>

      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link active" [ngClass]="{'active': viewMailboxSubscreen == 'inbox'}"
            (click)="viewMailboxSubscreen = 'inbox'" href="#">Inbox</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [ngClass]="{'active': viewMailboxSubscreen == 'sendMessage'}"
            (click)="viewMailboxSubscreen = 'sendMessage'" href="#">Send a message</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [ngClass]="{'active': viewMailboxSubscreen == 'addKey'}"
            (click)="viewMailboxSubscreen = 'addKey'" href="#">Add
            public key</a>
        </li>
      </ul>

      <div class="row" *ngIf="viewMailboxSubscreen == 'inbox'">
        <div class="col-sm-12" *ngIf="activeMailbox.messageCount == 0">
          <h2 class="text-center align-middle mt-8 mt-4 text-muted">No messages</h2>
        </div>
        <div class="col-sm-12" *ngIf="activeMailbox.messageCount > 0">
          <button class="btn btn-success mt-4 mb-4" type="button" (click)="getMessages(activeMailbox)">Fetch
            All</button>
          <button class="btn btn-danger mt-4 mb-4 float-right" type="button"
            (click)="deleteMessages(activeMailbox)">Delete All</button>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>From</th>
                <th>Nonce</th>
                <th>Time</th>
                <th>Message</th>
                <th></th>
              </tr>
            </thead>
            <tr *ngFor="let message of activeMailbox.messages">
              <td>
                <div class="overflow-box">{{message.fromTag || message.from}}</div>
              </td>
              <td>
                <div class="overflow-box">{{message.nonce}}</div>
              </td>
              <td>
                <div class="overflow-box">{{message.time * 1000 | date:'short'}}</div>
              </td>
              <td>
                <div class="overflow-wrap">{{message.msg || message.data}}</div>
              </td>
              <td>
                <button class="btn btn-mini btn-danger" (click)="deleteMessages(activeMailbox, [message.nonce])">
                  <i class="glyphicon glyphicon-remove"></i> Delete
                </button>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="row" *ngIf="viewMailboxSubscreen == 'sendMessage'">
        <div class="col-sm-6">
          <span class="badge badge-success" [ngClass]="{'badge-show': messageSent}">Message sent!</span>
          <select type="text" [(ngModel)]="newMessage.recipient" class="form-control custom-select">
            <option value="" disabled selected>Recipient</option>
            <option *ngFor="let guest of activeMailbox.recipients" value="{{ guest }}">{{ guest }}</option>
          </select>
          <textarea [(ngModel)]="newMessage.message" placeholder="Message" rows="3"
            class="form-control mt-2"></textarea>
          <button class="btn btn-success btn-lg btn-block mt-2" type="button"
            (click)="sendMessage(activeMailbox, newMessage.recipient, newMessage.message)">Send</button>
        </div>
      </div>

      <div class="row" *ngIf="viewMailboxSubscreen == 'addKey'">
        <div class="col-sm-6">
          <span class="badge badge-success" [ngClass]="{'badge-show': keyAdded}">Key added!</span>
          <input type="text" [(ngModel)]="newPubKey.name" placeholder="User Name" class="form-control">
          <input type="text" [(ngModel)]="newPubKey.key" placeholder="Public Key (Base64)" class="form-control mt-2">
          <button class="btn btn-success btn-lg btn-block mt-2" type="button"
            (click)="addPublicKey(activeMailbox, newPubKey.name, newPubKey.key)">Add</button>
        </div>
      </div>
    </div>
  </div>
</div>
